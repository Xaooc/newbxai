# Автономный агент Bitrix24

Проект содержит реализацию агента, который следует методологии Plan → Act → Observe → Adjust → Report и выполняет операции в Bitrix24 исключительно через входящий вебхук.

## Основные возможности

- Планирование шагов для достижения цели.
- Поддержка инструментов `bitrix_call` и `bitrix_batch`.
- Высокоуровневый клиент `BitrixWebhookClient` с методами `user.*`, `crm.*`, `tasks.*`, `event.*` и `sonet.*`.
- Хранение микроконтекста задачи в JSON-структуре.
- Обработка ответов Bitrix24 и управление ошибками.
- CLI-интерфейс для запуска агента в интерактивном сценарии.
- Полный цикл взаимодействия через Telegram: построение плана, запрос уточнений, финальный отчёт.

## Быстрый старт

1. Скопируйте файл `.env` и при необходимости скорректируйте значения переменных `BITRIX_BASE_URL` и `BITRIX_DEFAULT_TZ`.
2. Запустите агента через вспомогательный скрипт:

```bash
python run_agent.py --prompt "Создай сделку на 1 000 000 ₽ и назначь на Иванова Ивана"
```

При необходимости можно указать собственный файл окружения:

```bash
python run_agent.py --env-file production.env --prompt "Создай задачу завтра 12:00"
```

CLI по-прежнему доступен и через модульный запуск:

```bash
python -m bitrix_agent --prompt "Проверь открытые сделки"
```

## Запуск через Telegram

1. Установите переменные окружения:
   - `BITRIX_BASE_URL` – адрес входящего вебхука Bitrix24.
   - `TELEGRAM_BOT_TOKEN` – токен Telegram-бота (можно передать через `--token`).
   - Опционально список ID чатов, которым разрешён доступ (`--allowed-chat`).
2. Запустите бота:

```bash
python run_telegram_bot.py --env-file .env --allowed-chat 123456789
```

После запуска отправьте боту цель одной фразой. Если агенту потребуется дополнительная информация, бот задаст уточняющие вопросы в том же чате.
