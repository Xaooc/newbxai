@dataclass
class BitrixAgentConfig:
    """
    Параметры, необходимые для запуска ассистента на LangChain.
    """

    llm: BaseChatModel
    client: Bitrix24Client
    ai_name: str = "Bitrix24 AI ассистент"
    memory: ConversationBufferMemory | None = None
    verbose: bool = False


def build_agent(
    config: BitrixAgentConfig,
    *,
    agent_kwargs: Mapping[str, Any] | None = None,
):
    """
    Создает AgentExecutor, настроенный на работу с Bitrix24 через инструменты LangChain.
    """
    bitrix_tool = BitrixAPITool(config.client)
    tool = Tool(
        name="bitrix_api",
        func=bitrix_tool.run,
        description=bitrix_tool.description,
    )

    memory = config.memory or ConversationBufferMemory(memory_key="chat_history", return_messages=True)

    merged_agent_kwargs: Dict[str, Any] = {
        "system_message": 