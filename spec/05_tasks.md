# 05. Журнал выполненных задач

* 2025-10-31 — Инициализация проекта, создание структуры /spec, /src, /docs.
* 2025-11-01 — Уточнены спецификации методов Bitrix24, режимов безопасности и структуры подтверждений; зафиксирован базовый вебхук портала.
* 2025-11-02 — Добавлен модуль GPT-клиента, обновлена архитектура и README, реализована обработка деградации модели и обновлён оркестратор.
* 2025-11-03 — Реализовано полное управление подтверждениями (одобрение и отклонение), обновлены спецификации безопасности и состояния.
* 2025-11-04 — Добавлена синхронизация состояния при чтении сделок и контактов, обновлены спецификации архитектуры и памяти.
* 2025-11-05 — Реализован HTTP API-адаптер для оркестратора, обновлена архитектура и описан эндпоинт `/chat`.
* 2025-11-06 — Настроена ротация JSONL-логов, описаны правила архивирования и устойчивости логирования.
* 2025-11-07 — Добавлены автоматизированные тесты с моками Bitrix и GPT, обновлена архитектура разделом о тестировании.
* 2025-11-08 — Реализована поддержка `batch` и `event.*`, обновлены спецификации безопасности и состояния, добавлены тесты и логика синхронизации подписок.
* 2025-11-09 — Переведены временные метки на timezone-aware UTC-формат, обновлены спецификации и устранены предупреждения pytest.
* 2025-11-10 — Внедрена аутентификация HTTP API по заголовку `X-API-Key`, обновлены спецификации безопасности и архитектуры, расширена документация.
* 2025-11-11 — Добавлены справочные методы Bitrix24 (категории сделок, стадии, статусы, рабочие группы), обновлены спецификации и оркестратор.
* 2025-11-12 — Настроен аудит и блокировка повторных ошибок аутентификации HTTP API, обновлены спецификации безопасности и архитектуры.
* 2025-11-13 — Реализована выгрузка архивов логов в S3-совместимое хранилище, добавлена автоматическая синхронизация накопленных архивов и тесты подсистемы логирования.
* 2025-11-14 — Настроен GitHub Actions workflow для запуска `pytest` с покрытием, добавлены dev-зависимости и публикация отчёта `coverage.xml`.
* 2025-11-15 — Добавлены интеграционные тесты оркестратора для пакетных вызовов и управления подписками на события Bitrix24.
* 2025-11-16 — Детализированы описания REST-методов Bitrix24, внедрена валидация обязательных параметров и автоопределение HTTP-методов в оркестраторе.
* 2025-11-17 — Настроен контроль `DeprecationWarning` в CI, обновлена архитектурная спецификация и workflow тестов.
* Сделано в этой итерации:
  * 2025-11-18 — Добавлены автотесты для чтения справочников (`crm.status.list`, `crm.deal.category.*`, `sonet.group.*`), уточнена спецификация архитектуры по обновлению истории `done`.
  * 2025-11-19 — Внедрена загрузка конфигурации из `.env`, реализован Telegram-адаптер и обновлены спецификации архитектуры и безопасности под новый канал связи.
  * 2025-11-20 — Выделен модуль `src/app/telegram_runner.py` для запуска Telegram-бота и обновлена архитектура, чтобы CLI делегировала запуск этому модулю.
  * 2025-11-21 — Проведена оценка Telegram-канала, зафиксированы ограничения в архитектуре и реализовано разбиение длинных сообщений на части.
  * 2025-11-22 — Настроена интеграция с ChatGPT и добавлено пользовательское резюме действий без технических деталей в ответах Telegram-бота.
  * 2025-11-23 — Проведён аудит логики принятия решений, внедрён модуль текстового резюме состояния и обновлены спецификации под использование контекста без повторных уточнений.
  * 2025-11-24 — Закрыт весь оставшийся TODO: внедрены self-check контекста, асинхронная обработка Telegram с уведомлениями об ошибках, мониторинг выгрузок логов с ретраями, расширенные автотесты (Telegram-адаптер, запуск, резюме, валидация) и статические проверки `ruff`/`mypy`.
  * 2025-11-25 — Реализована параллельная обработка пользователей: оркестратор получил блокировки на уровне каждого пользователя, Telegram-адаптер использует настраиваемый пул потоков, спецификации обновлены и добавлены тесты на конкурентность.
  * 2025-11-26 — Переименован пакет логирования в `src/app_logging`, обновлены спецификации и импорты для исключения конфликта со стандартной библиотекой `logging`.
  * 2025-11-27 — Исправлена CLI-точка входа: добавлена инициализация `sys.path` для корректных импортов при прямом запуске скрипта, обновлена архитектурная спецификация.
* 2025-11-27 — Сделано в этой итерации:
  * Обновлены разделы спецификаций 00–04 для описания расширенного логирования и маскирования данных.
  * Реализовано подробное консольное и файловое логирование вызовов Bitrix24 с текстами ошибок и рекомендуемыми действиями для повторов.
* 2025-11-28 — Сделано в этой итерации:
  * Уточнены правила подтверждения плана: добавлена структура `plan_confirmation`, описан словарь фраз и требования к повторной отправке шагов с `confirmed: true`.
  * Обновлены описания всех разрешённых методов Bitrix24, явно разделён поиск сотрудников (`user.get`) и CRM-клиентов (`crm.contact.*`), расширены инструкции в системном промпте.
  * Обновлён `DEFAULT_SYSTEM_PROMPT` и архитектура, чтобы план всегда запрашивался у пользователя до выполнения.
* 2025-11-29 — Сделано в этой итерации:
  * Исправлена логика повторного подтверждения плана: добавлена канонизация шагов при расчёте хеша, обновлены спецификации и тесты, чтобы после одобрения выполнение начиналось без повторного запроса.
* 2025-11-30 — Сделано в этой итерации:
  * Переведён агент в режим мгновенного исполнения: подтверждения плана и отдельных шагов отключены, обновлены спецификации безопасности/состояния/архитектуры и оркестратор, добавлены тесты на последовательное выполнение и обработку ошибок.
* 2025-12-01 — Сделано в этой итерации:
  * Обновлены конституция, архитектура, методы и безопасность под новую политику без подтверждений и с обязательным описанием ошибок.
  * Переработаны состояние и код оркестратора для немедленного выполнения шагов, детальных предупреждений и последовательного ответа пользователю.
* 2025-12-02 — Сделано в этой итерации:
  * Проведён стресс-тест на 12 параллельных пользователей, метрики отклика задокументированы и добавлен адаптивный пул потоков Telegram-бота.
  * Удалён временный патч `_Updater__polling_cleanup_cb`, промпт дополнен примерами выбора методов, внедрены ретраи и мониторинг ошибок Bitrix24 с алертами.
  * Добавлены сбор и логирование статистики по недостающим данным и рискованным изменениям, расширены автотесты для новых сценариев.
